<div class="container py-4">
  <h2 class="mb-3">Mis Pedidos</h2>

  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start mb-3 gap-2">
    <input type="search" class="form-control w-100 w-md-50" placeholder="Buscar pedido..." [(ngModel)]="searchTerm" (input)="applyAllFilters()">
    <select class="form-select w-auto ms-md-2" [(ngModel)]="sortOrder" (change)="applySort()">
      <option value="recent">Más recientes</option>
      <option value="oldest">Más antiguos</option>
      <option value="total_desc">Mayor total</option>
      <option value="total_asc">Menor total</option>
    </select>
  </div>

  <div *ngIf="loading" class="text-center my-5">
    <app-loading-spinner></app-loading-spinner>
  </div>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <div *ngIf="!loading && filtered.length > 0">
    <div class="card mb-3" *ngFor="let order of pagedItems">
      <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-center">
        <div>
          <h5>#{{ order.id }}</h5>
          <p class="mb-1 text-muted">Fecha: {{ order.fecha | date:'medium' }}</p>
          <span [ngClass]="statusClass(order.estado)">{{ order.estado }}</span>
        </div>
        <div class="text-end mt-3 mt-md-0">
          <p class="fw-bold mb-1">{{ order.total | currency:'COP':'symbol' }}</p>
          <a [routerLink]="['/orders', order.id]" class="btn btn-outline-primary btn-sm">Ver detalle</a>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-between align-items-center mt-3">
      <div>Mostrando {{ (page-1)*size + 1 }} - {{ (page*size) < filtered.length ? (page*size) : filtered.length }} de {{ filtered.length }}</div>
      <div>
        <button class="btn btn-sm btn-outline-secondary me-2" (click)="prevPage()" [disabled]="page===1">Anterior</button>
        <button class="btn btn-sm btn-outline-secondary" (click)="nextPage()" [disabled]="page*size >= filtered.length">Siguiente</button>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && filtered.length === 0" class="text-center mt-5">
    <p>No tienes pedidos aún.</p>
    <a routerLink="/products" class="btn btn-primary">Ir a comprar</a>
  </div>
</div>
