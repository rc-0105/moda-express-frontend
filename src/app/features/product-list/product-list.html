<!-- src/app/features/product-list/product-list.component.html -->
<!--
  ProductListComponent template
  - Responsive grid: col-12 / col-md-6 / col-lg-4 / col-xl-3
  - Filtros visibles, tamaño de página, spinner, error, empty state
  - A11y: aria-live, aria-labels, focus visible
  - NOTE: Personalizar estilos o añadir tracking/eventos dentro de los comentarios marcados.
-->

<div class="container py-3" aria-live="polite">

  <!-- Filters Row -->
  <div class="d-flex flex-column flex-md-row gap-3 align-items-start mb-3">
    <!-- Search -->
    <div class="flex-fill">
      <label for="search" class="form-label visually-hidden">Buscar productos</label>
      <input id="search" type="search" class="form-control" [(ngModel)]="q"
             (keyup.enter)="onFilterApply()" placeholder="Buscar productos (nombre, descripción...)"
             aria-label="Buscar productos">
    </div>

    <!-- Selects & Actions -->
    <div class="d-flex gap-2 flex-wrap" role="group" aria-label="Filtros de productos">
      <select class="form-select" [(ngModel)]="categoria" aria-label="Filtrar por categoría">
        <option [ngValue]="null">Todas las categorías</option>
        <option *ngFor="let c of categories" [value]="c.id">{{ c.name }}</option>
      </select>

      <select class="form-select" [(ngModel)]="talla" aria-label="Filtrar por talla">
        <option [ngValue]="null">Todas las tallas</option>
        <option *ngFor="let t of tallas" [value]="t">{{ t }}</option>
      </select>

      <select class="form-select" [(ngModel)]="color" aria-label="Filtrar por color">
        <option [ngValue]="null">Todos los colores</option>
        <option *ngFor="let c of colores" [value]="c">{{ c }}</option>
      </select>

      <div class="d-flex gap-1 align-items-center">
        <button class="btn btn-primary" (click)="onFilterApply()" aria-label="Aplicar filtros">Aplicar</button>
        <button class="btn btn-outline-secondary" (click)="clearFilters()" aria-label="Limpiar filtros">Limpiar</button>
      </div>
    </div>
  </div>

  <!-- Top bar: counts + size selector -->
  <div class="d-flex justify-content-between align-items-center mb-2">
    <div>
      <small class="text-muted">Página {{page}} de {{ totalPages }} — {{ total }} resultados</small>
    </div>

    <div class="btn-group" role="group" aria-label="Tamaño de página">
      <button *ngFor="let s of sizeOptions" class="btn btn-outline-secondary"
              [class.active]="s === size" (click)="changeSize(s)" [attr.aria-pressed]="s===size">
        {{ s }}
      </button>
    </div>
  </div>

  <!-- Error alert -->
  <div *ngIf="error" class="alert alert-danger" role="alert" aria-live="assertive">
    <div class="d-flex justify-content-between align-items-start">
      <div>
        <strong>Error:</strong> {{ error }}
      </div>
      <div class="ms-3">
        <button class="btn btn-sm btn-light me-2" (click)="retry()" aria-label="Reintentar carga">Reintentar</button>
        <button class="btn btn-sm btn-outline-secondary" (click)="clearFilters()" aria-label="Restablecer filtros">Volver</button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="d-flex justify-content-center my-5" aria-hidden="false">
    <app-loading-spinner></app-loading-spinner>
  </div>

  <!-- Empty state -->
  <div *ngIf="!loading && !error && products.length === 0" class="text-center my-5" role="status">
    <p class="lead">No se encontraron productos que coincidan con la búsqueda.</p>
    <button class="btn btn-outline-primary" (click)="clearFilters()" aria-label="Limpiar filtros">Limpiar filtros</button>
  </div>

  <!-- Product Grid -->
  <div *ngIf="!loading && !error && products.length > 0" class="row g-3" role="list" aria-label="Lista de productos">
    <!--
      Column classes implement the breakpoints:
      - col-12 (xs)
      - col-md-6 (>=768px)
      - col-lg-4 (>=992px)
      - col-xl-3 (>=1200px)
    -->
    <div *ngFor="let p of products" class="col-12 col-md-6 col-lg-4 col-xl-3" role="listitem">
      <!-- app-product-card is responsible for image alt text & internal accessibility -->
      <app-product-card [product]="p" (add)="onAddFromCard($event)"></app-product-card>
    </div>
  </div>

  <!-- Pagination -->
  <nav *ngIf="!loading && totalPages > 1" class="d-flex justify-content-center mt-4" aria-label="Paginación de productos">
    <ul class="pagination">
      <li class="page-item" [class.disabled]="page === 1">
        <button class="page-link" (click)="prevPage()" aria-label="Página anterior" [disabled]="page === 1">Anterior</button>
      </li>

      <li class="page-item" *ngFor="let p of pagesArray()" [class.active]="p === page">
        <button class="page-link"
                (click)="goToPage(p)"
                [attr.aria-current]="p === page ? 'page' : null"
                [attr.aria-label]="'Ir a la página ' + p">
          {{ p }}
        </button>
      </li>

      <li class="page-item" [class.disabled]="page === totalPages">
        <button class="page-link" (click)="nextPage()" aria-label="Página siguiente" [disabled]="page === totalPages">Siguiente</button>
      </li>
    </ul>
  </nav>

  <!-- Small note: lugar para tracking o custom hooks -->
  <!--
    CUSTOMIZATION POINT:
    - Aquí puedes añadir atributos data-* para tracking (p.ej. data-track="product-list")
    - O enviar eventos al analytics cuando se cambie página / filtros.
  -->

</div>
